"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ContentDirectoryService = void 0;
const array_helper_1 = __importDefault(require("../helpers/array-helper"));
const metadata_helper_1 = __importDefault(require("../helpers/metadata-helper"));
const xml_helper_1 = __importDefault(require("../helpers/xml-helper"));
const content_directory_service_1 = require("./content-directory.service");
/**
 * Browse for local content
 *
 * @export
 * @class ContentDirectoryService
 * @extends {ContentDirectoryServiceBase}
 */
class ContentDirectoryService extends content_directory_service_1.ContentDirectoryServiceBase {
    /**
     * Browse or search content directory
     *
     * @param {string} input.ObjectID The search query, ['A:ARTIST','A:ALBUMARTIST','A:ALBUM','A:GENRE','A:COMPOSER','A:TRACKS','A:PLAYLISTS'] with optionally ':search+query' behind it.
     * @param {string} input.BrowseFlag How to browse [ BrowseMetadata,BrowseDirectChildren ]
     * @param {string} input.Filter Which fields should be returned '*' for all.
     * @param {number} input.StartingIndex Where to start in the results, (could be used for paging)
     * @param {number} input.RequestedCount How many items should be returned, 0 for all.
     * @param {string} input.SortCriteria Sort the results based on metadata fields. '+upnp:artist,+dc:title' for sorting on artist then on title.
     * @returns {Promise<BrowseResponse>}
     * @memberof ContentDirectoryService
     * @see http://www.upnp.org/specs/av/UPnP-av-ContentDirectory-v1-Service.pdf
     */
    async BrowseParsed(input) {
        const resp = await this.Browse(input);
        if (typeof resp.Result === 'string' && resp.NumberReturned > 0) {
            const parsedData = xml_helper_1.default.DecodeAndParseXml(resp.Result)['DIDL-Lite'];
            const itemObject = parsedData.item || parsedData.container;
            const items = array_helper_1.default.ForceArray(itemObject);
            resp.Result = items
                .map((i) => metadata_helper_1.default.ParseDIDLTrack(i, this.host, this.port))
                .filter((i) => typeof i !== 'undefined');
        }
        return resp;
    }
    /**
     * Same as BrowseParsed but with all parameters set to default.
     *
     * @param {string} ObjectID The search query, ['A:ARTIST','A:ALBUMARTIST','A:ALBUM','A:GENRE','A:COMPOSER','A:TRACKS','A:PLAYLISTS'] with optionally ':search+query' behind it.
     * @returns {Promise<BrowseResponse>}
     * @memberof SonosDevice
     */
    async BrowseParsedWithDefaults(ObjectID) {
        return await this.BrowseParsed({
            ObjectID, BrowseFlag: 'BrowseDirectChildren', Filter: '*', StartingIndex: 0, RequestedCount: 0, SortCriteria: '',
        });
    }
}
exports.ContentDirectoryService = ContentDirectoryService;
//# sourceMappingURL=content-directory.service.extension.js.map